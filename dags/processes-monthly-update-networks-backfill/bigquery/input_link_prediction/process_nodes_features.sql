with original as (SELECT 
    *
FROM  
-- Using only the historical features table for now
--`storage-dev-olvin-com.sg_networks_staging.node_features_historical`
`{{ params['project'] }}.{{ params['networks_staging_dataset'] }}.{{ params['node_features_raw_table'] }}`),
processing_percentages as
(
    SELECT
        fk_sgplaces,
        olvin_category,
        latitude,
        longitude,
        log(visits_total+1) as visits_total,
        (visits_weekend - avg_visits_weekend) / std_visits_weekend as visits_weekend,
        (visits_weekday - avg_visits_weekday) / std_visits_weekday as visits_weekday,
        (visits_morning - avg_visits_morning) / std_visits_morning as visits_morning,
        (visits_afternoon - avg_visits_afternoon) / std_visits_afternoon as visits_afternoon,
        (visits_evening - avg_visits_evening) / std_visits_evening as visits_evening,
        (fk_life_stages_1 - avg_fk_life_stages_1) / std_fk_life_stages_1 as fk_life_stages_1,
        (fk_life_stages_2 - avg_fk_life_stages_2) / std_fk_life_stages_2 as fk_life_stages_2,
        (fk_life_stages_3 - avg_fk_life_stages_3) / std_fk_life_stages_3 as fk_life_stages_3,
        (fk_life_stages_4 - avg_fk_life_stages_4) / std_fk_life_stages_4 as fk_life_stages_4,
        (fk_life_stages_5 - avg_fk_life_stages_5) / std_fk_life_stages_5 as fk_life_stages_5,
        (fk_incomes_1 - avg_fk_incomes_1) / std_fk_incomes_1 as fk_incomes_1,
        (fk_incomes_2 - avg_fk_incomes_2) / std_fk_incomes_2 as fk_incomes_2,
        (fk_incomes_3 - avg_fk_incomes_3) / std_fk_incomes_3 as fk_incomes_3,
        (fk_incomes_4 - avg_fk_incomes_4) / std_fk_incomes_4 as fk_incomes_4,
        (fk_incomes_5 - avg_fk_incomes_5) / std_fk_incomes_5 as fk_incomes_5,

    from original
    CROSS JOIN ( SELECT
        avg(visits_weekend) AS avg_visits_weekend,
        stddev(visits_weekend) AS std_visits_weekend,
        avg(visits_weekday) AS avg_visits_weekday,
        stddev(visits_weekday) AS std_visits_weekday,
        avg(visits_morning) AS avg_visits_morning,
        stddev(visits_morning) AS std_visits_morning,
        avg(visits_afternoon) AS avg_visits_afternoon,
        stddev(visits_afternoon) AS std_visits_afternoon,
        avg(visits_evening) AS avg_visits_evening,
        stddev(visits_evening) AS std_visits_evening,
        avg(fk_life_stages_1) AS avg_fk_life_stages_1,
        stddev(fk_life_stages_1) AS std_fk_life_stages_1,
        avg(fk_life_stages_2) AS avg_fk_life_stages_2,
        stddev(fk_life_stages_2) AS std_fk_life_stages_2,
        avg(fk_life_stages_3) AS avg_fk_life_stages_3,
        stddev(fk_life_stages_3) AS std_fk_life_stages_3,
        avg(fk_life_stages_4) AS avg_fk_life_stages_4,
        stddev(fk_life_stages_4) AS std_fk_life_stages_4,
        avg(fk_life_stages_5) AS avg_fk_life_stages_5,
        stddev(fk_life_stages_5) AS std_fk_life_stages_5,
        avg(fk_incomes_1) AS avg_fk_incomes_1,
        stddev(fk_incomes_1) AS std_fk_incomes_1,
        avg(fk_incomes_2) AS avg_fk_incomes_2,
        stddev(fk_incomes_2) AS std_fk_incomes_2,
        avg(fk_incomes_3) AS avg_fk_incomes_3,
        stddev(fk_incomes_3) AS std_fk_incomes_3,
        avg(fk_incomes_4) AS avg_fk_incomes_4,
        stddev(fk_incomes_4) AS std_fk_incomes_4,
        avg(fk_incomes_5) AS avg_fk_incomes_5,
        stddev(fk_incomes_5) AS std_fk_incomes_5,
        
    from original
    )
),



-- We fix the 40 degrees otherwise we bring distort the mapping
adding_first_transformation_to_delta_meters as (
select
    *,
    --(latitude - avg(latitude) over ()) * 111195 as distance_avg_latitude0,
    sign(latitude - avg_latitude) * ST_DISTANCE ( ST_GEOGPOINT(avg_longitude, avg_latitude), ST_GEOGPOINT(avg_longitude, latitude) ) as distance_avg_latitude,
    -- (longitude - avg(longitude) over ()) * 111195 * cos(3.141591 / 180 * 40  ) as longitude_trf,
    sign((longitude - avg_longitude)) * ST_DISTANCE (ST_GEOGPOINT(avg_longitude, avg_latitude), ST_GEOGPOINT(longitude, avg_latitude)) as distance_avg_longitude,

from processing_percentages
CROSS JOIN (SELECT avg(latitude) AS avg_latitude, avg(longitude) AS avg_longitude FROM processing_percentages)
),

standard_deviation_of_milwaukee as (
    select
        stddev(distance_avg_latitude) as stddev_distance_avg_latitude,
    -- stddev(distance_avg_longitude) as stddev_distance_avg_longitude
    from adding_first_transformation_to_delta_meters
    where ST_INTERSECTS(
        ST_GEOGFROMTEXT("POLYGON ((-88.340947137 43.54328209, -88.281039119 43.5428520940001, -88.24070110700001 43.542903096, -88.2144640989999 43.543054098, -88.1608790829999 43.542951101, -88.148550079 43.542759102, -88.12792807300001 43.5426851030001, -88.09930106500001 43.5423731050001, -88.07076805600001 43.5424171060001, -88.057649052 43.542361107, -88.04053404699989 43.5423691080001, -88.010567038 43.5426281100001, -87.970983027 43.5427501120001, -87.957672023 43.542869113, -87.923989013 43.543362115, -87.911756009 43.5434221160001, -87.901705006 43.543421117, -87.83295898499991 43.543061121, -87.791416289 43.543025904, -87.79143196 43.5423270300001, -87.791683001 43.5416509570001, -87.791700049 43.541174948, -87.79200307000001 43.540242988, -87.79215800599999 43.5388970270001, -87.792269989 43.538666042, -87.79220096099991 43.538333939, -87.79236492299999 43.5375570830001, -87.792304921 43.5368689760001, -87.79265006 43.535892055, -87.7926069389999 43.53541003, -87.79269401800001 43.5351469550001, -87.7927020399999 43.5346900000001, -87.792815025 43.534408038, -87.792840932 43.534025961, -87.79320195 43.5323799880001, -87.79375902 43.531014973, -87.79373094100001 43.530693065, -87.793949056 43.530126969, -87.79404599599999 43.5293679960001, -87.794042987 43.528635933, -87.794116026 43.5284450610001, -87.79400805499991 43.5274960520001, -87.79416800599989 43.5267589740001, -87.79419508300001 43.5261840200001, -87.7940010359999 43.5242149690001, -87.7935649729999 43.522224023, -87.7936829719999 43.521475078, -87.793619961 43.5206440690001, -87.7936899919999 43.5185449850001, -87.79355093300001 43.5175869500001, -87.79366208 43.5152690830001, -87.79355093300001 43.514483033, -87.79383506800001 43.5129010740001, -87.79373094100001 43.5122609360001, -87.79388403900001 43.5114100370001, -87.793786932 43.5109250030001, -87.79384894 43.510451, -87.79370403199989 43.508949935, -87.79376603999999 43.508157033, -87.793429926 43.507026011, -87.793399005 43.5067109560001, -87.793485081 43.505457924, -87.793678961 43.5047069730001, -87.793891059 43.5028530800001, -87.794035967 43.502320078, -87.794067055 43.501399984, -87.7938940669999 43.5001830530001, -87.793627984 43.499637014, -87.793300059 43.4991860760001, -87.792840932 43.4962640050001, -87.792329991 43.494959995, -87.792194944 43.494368996, -87.7916559239999 43.4931960220001, -87.79156098999989 43.493101924, -87.790992053 43.492948992, -87.7909190139999 43.492803081, -87.79102899 43.4926859170001, -87.79149497100001 43.4926720450001, -87.79164104900001 43.492606026, -87.79157603199999 43.492037924, -87.7921549979999 43.491477009, -87.79252002699999 43.4907629960001, -87.7926950199999 43.489989984, -87.7928039939999 43.488969942, -87.79311102699999 43.488300053, -87.79417502599991 43.486958939, -87.79511601199989 43.4850940150001, -87.7961509299999 43.483301963, -87.79744207 43.4813050000001, -87.798186 43.4799060560001, -87.79876897699999 43.479162961, -87.799636924 43.4774870700001, -87.800571057 43.475462027, -87.80125598799999 43.473202992, -87.80202699500001 43.471265029, -87.802903968 43.4685249710001, -87.8035019869999 43.4669219520001, -87.80372996299999 43.465541059, -87.803994041 43.464765038, -87.80388105500001 43.463818035, -87.8042019599999 43.4629980560001, -87.80430007 43.4628710320001, -87.80462498599999 43.4627359840001, -87.80583907499989 43.461908986, -87.80617301699991 43.4615469660001, -87.806617938 43.460922037, -87.80695004099989 43.459927065, -87.80716498 43.4598209330001, -87.80774996299991 43.459292944, -87.80877301299989 43.458177968, -87.81110207899999 43.455074051, -87.811983063 43.453561955, -87.812173934 43.453067059, -87.81226201600001 43.4525489320001, -87.812631056 43.451974981, -87.81275206399989 43.451387993, -87.81274404200001 43.450812036, -87.812640082 43.4504500150001, -87.812726993 43.450057074, -87.81295898099999 43.449933058, -87.813074974 43.4497749450001, -87.8146840109999 43.44915102, -87.816007074 43.447999941, -87.81742106 43.446192011, -87.8181389169999 43.4455460230001, -87.81886396100001 43.4446829230001, -87.81994500899999 43.443744946, -87.8214320339999 43.4419649280001, -87.823603991 43.439109043, -87.8247390239999 43.437175927, -87.8258379549999 43.4355179190001, -87.82658004699999 43.434553032, -87.827427938 43.433602018, -87.8296390039999 43.4313650450001, -87.831143078 43.4300060470001, -87.832492047 43.428349042, -87.83658692499991 43.4240649650001, -87.836883929 43.423648959, -87.837391025 43.4231320010001, -87.8380940069999 43.422060982, -87.838385997 43.4217549530001, -87.839260963 43.421208078, -87.8409930129999 43.419708015, -87.8432430229999 43.4174419600001, -87.8441069579999 43.41646504, -87.845977064 43.414804024, -87.849319988 43.411613028, -87.85293701800001 43.407809973, -87.854107986 43.4064399440001, -87.8566849169999 43.402770934, -87.85799795199991 43.401048077, -87.859263019 43.399481995, -87.86055599699991 43.398180994, -87.86149096600001 43.397116995, -87.863049025 43.395142929, -87.863414054 43.39477907, -87.864054025 43.3938900640001, -87.864050014 43.393805994, -87.86371507 43.3934379560001, -87.86368899599999 43.393309929, -87.864498946 43.3919699840001, -87.864979969 43.391845968, -87.865126047 43.3916779950001, -87.865232013 43.391165049, -87.8651710079999 43.390385016, -87.864544073 43.390341059, -87.859509046 43.385273941, -87.85949400299999 43.3851920430001, -87.859629051 43.3851410660001, -87.859723985 43.385360017, -87.8622950659999 43.3879580070001, -87.86241005700001 43.387982075, -87.863365919 43.38747899, -87.863556957 43.3875010530001, -87.862492958 43.388123975, -87.86395106799991 43.389640918, -87.864658061 43.389782986, -87.8650429799999 43.389933075, -87.865178027 43.3899220440001, -87.865589019 43.3896509470001, -87.865962071 43.389222071, -87.866735084 43.387578939, -87.86660003599999 43.387426008, -87.866743942 43.387211068, -87.866373063 43.3871400350001, -87.86355094 43.3883039830001, -87.8635039749999 43.3882269320001, -87.866369052 43.3870489450001, -87.8668009359999 43.3871579190001, -87.867023062 43.386935959, -87.8669839519999 43.386815955, -87.867665039 43.387059976, -87.867781032 43.387235972, -87.8669540339999 43.3891159390001, -87.867687936 43.3891089190001, -87.868545019 43.387177975, -87.868567082 43.38716895, -87.87029094099999 43.387177975, -87.87028108 43.386777011, -87.86884102 43.386788042, -87.8690639819999 43.3864529310001, -87.8707410439999 43.386559064, -87.870718981 43.386470982, -87.869223933 43.3863579970001, -87.869038076 43.3861430580001, -87.86786192700001 43.386412985, -87.8639390339999 43.3851119840001, -87.863967949 43.3849480220001, -87.863873015 43.384890025, -87.86139101799991 43.3840740580001, -87.860683022 43.3844569710001, -87.861294078 43.384037956, -87.861411074 43.3840299340001, -87.864008062 43.3848139770001, -87.86459705599999 43.383909929, -87.8647210719999 43.383851932, -87.86852395999991 43.3850319250001, -87.86851693999991 43.3849739280001, -87.86793496600001 43.3847040010001, -87.86410901399999 43.3834110220001, -87.8640389829999 43.3833269520001, -87.864144948 43.3832950290001, -87.866304035 43.3840299340001, -87.866428051 43.383943022, -87.86708005600001 43.382962926, -87.86879204900001 43.3835460700001, -87.86897406200001 43.383552922, -87.8693240489999 43.38338896, -87.8694699599999 43.3831260520001, -87.8700129909999 43.38262397, -87.870778984 43.3816550720001, -87.87182092099989 43.3800039170001, -87.87257605000001 43.378558007, -87.87271093 43.3780840050001, -87.873045039 43.3774689370001, -87.87329106599999 43.3767729750001, -87.874984005 43.373901045, -87.875579016 43.3725280080001, -87.875963934 43.371911938, -87.876972946 43.369546937, -87.87781298 43.3656680020001, -87.878210936 43.364675036, -87.879327082 43.360774039, -87.87939995399989 43.3602789760001, -87.87991306799999 43.358898083, -87.88076998299989 43.356094012, -87.880846031 43.35553293, -87.88186908199999 43.3516660280001, -87.882074996 43.350429041, -87.882214054 43.349066032, -87.88224096399991 43.347769042, -87.882658975 43.344371965, -87.8830270129999 43.342391048, -87.88382593199999 43.340236975, -87.884220043 43.338634959, -87.884653933 43.3354680310001, -87.88533100799999 43.332374977, -87.885345048 43.331609987, -87.885671969 43.327991954, -87.885665952 43.3276740580001, -87.885441988 43.3266000300001, -87.885438979 43.324593039, -87.8857120819999 43.322880043, -87.88588507 43.321190948, -87.88608396399999 43.320483955, -87.886264975 43.3201339680001, -87.88635506200001 43.319472938, -87.887125066 43.317886967, -87.887877019 43.315945995, -87.888344002 43.314031932, -87.88836807 43.313606065, -87.888143938 43.3121200420001, -87.888476041 43.308674997, -87.889757988 43.305008995, -87.89021895499999 43.3040409330001, -87.89139794499989 43.3023249290001, -87.892624068 43.299774071, -87.894010978 43.2973930250001, -87.895381007 43.295680029, -87.896653929 43.2935729220001, -87.89725796499999 43.2923210600001, -87.898387984 43.290785063, -87.8988960829999 43.289817, -87.89920996799999 43.289409017, -87.90054005099999 43.286250947, -87.901545051 43.284271032, -87.90197292399991 43.2832319360001, -87.90233895599989 43.2819429690001, -87.90250592699989 43.281075022, -87.903349973 43.279441918, -87.903648983 43.2781029770001, -87.904912043 43.2743629330001, -87.90531501299991 43.2727839820001, -87.9057689589999 43.271398075, -87.906220064 43.2693509700001, -87.906862041 43.267985955, -87.907226067 43.267033938, -87.907981029 43.263455015, -87.90853208199999 43.26190197, -87.90872997299989 43.2615850770001, -87.909224033 43.260004956, -87.90991598399999 43.258620051, -87.9106739539999 43.256362019, -87.91174397 43.2513560730001, -87.91203896899999 43.2485030300001, -87.911973952 43.2470940580001, -87.91159705599991 43.2440810640001, -87.911560954 43.243303037, -87.911040988 43.239572019, -87.910389986 43.2369369240001, -87.909692019 43.234837004, -87.90897198899999 43.232982943, -87.9068819299999 43.2286579170001, -87.905542989 43.2263549250001, -87.904477986 43.224708951, -87.90311397399999 43.2229670400001, -87.901889021 43.2211840140001, -87.90087399299991 43.2200100370001, -87.900628969 43.2196110790001, -87.89920996799999 43.2178140130001, -87.89834803799999 43.216987015, -87.89790997 43.2164690550001, -87.8975830479999 43.2159240180001, -87.8974439899999 43.215513026, -87.8967530419999 43.214651932, -87.8965929239999 43.2142549800001, -87.896417931 43.2133920470001, -87.896382999 43.2124510610001, -87.8961690619999 43.210982922, -87.89593707499991 43.209789056, -87.89595495899989 43.208585998, -87.89654996900001 43.2071260490001, -87.897049043 43.206227014, -87.89749396400001 43.204120075, -87.897572017 43.2031969720001, -87.89748694399999 43.201343079, -87.89722303400001 43.1999899310001, -87.89681404700001 43.1987539470001, -87.8959669929999 43.197197058, -87.89527103099999 43.1956909780001, -87.8941259689999 43.1939940280001, -87.8920340719999 43.1911510130001, -87.88906804299999 43.1882939590001, -87.8875139959999 43.1870019830001, -87.886764048 43.1856490020001, -87.886376957 43.185112991, -87.886338014 43.184339978, -87.886168035 43.1832119650001, -87.885541936 43.181204974, -87.88528003099999 43.1807379900001, -87.8849930549999 43.1799589610001, -87.88428104800001 43.1786529460001, -87.88410806099991 43.1779019950001, -87.8837109409999 43.1769610090001, -87.882262023 43.1748550720001, -87.8816240579999 43.1729179450001, -87.88101901899999 43.1718099880001, -87.880742071 43.1706530600001, -87.8808909909999 43.170118051, -87.881206046 43.1696970310001, -87.881369005 43.1691200710001, -87.88159999 43.169009927, -87.88186908199999 43.1686739800001, -87.88234692899999 43.1675479730001, -87.8825209189999 43.166949953, -87.8829880699999 43.166124961, -87.88315504000001 43.166030027, -87.883396053 43.1654139560001, -87.883853008 43.164840005, -87.88435208200001 43.163672046, -87.884749034 43.163148069, -87.885394019 43.161768011, -87.88625093500001 43.160787079, -87.88651701800001 43.160259926, -87.88677892299999 43.1601250460001, -87.887576004 43.159140939, -87.8880150749999 43.158405031, -87.8885109729999 43.15736092, -87.88862095 43.1569890390001, -87.88914191800001 43.1545889390001, -87.889368056 43.1543940560001, -87.890703989 43.152387065, -87.89121392600001 43.150705993, -87.891565083 43.15044392, -87.8917880449999 43.149321924, -87.892787028 43.1477110490001, -87.893650963 43.146556962, -87.8941440199999 43.145580042, -87.89453295 43.1452860460001, -87.89475306999999 43.1448469750001, -87.896002927 43.143520068, -87.8973209759999 43.141920057, -87.897654082 43.141232953, -87.89789108399999 43.1410029720001, -87.89863902499999 43.139583971, -87.8991210509999 43.1392650720001, -87.8994220659999 43.1389570370001, -87.8998469309999 43.138340967, -87.90062596 43.136627971, -87.90087800399991 43.136255922, -87.90105801199999 43.135704033, -87.90134398399989 43.1328509900001, -87.901224982 43.130040066, -87.90105801199999 43.128568083, -87.90061593199989 43.126627946, -87.900290013 43.125859948, -87.90014092600001 43.125268948, -87.89956597199991 43.1245280260001, -87.899381953 43.123537066, -87.8989559189999 43.122727952, -87.89859907899999 43.121689023, -87.8981700369999 43.12078698, -87.8972489399999 43.119272042, -87.896122932 43.117933937, -87.89552691900001 43.116900022, -87.89435795599999 43.1156329500001, -87.89404005999999 43.114747955, -87.8936920789999 43.114230998, -87.892759951 43.1135310240001, -87.89205295799999 43.1128029720001, -87.891813951 43.1124140420001, -87.891522964 43.1122370430001, -87.89071401699989 43.1114580130001, -87.89055205999991 43.1110869670001, -87.8898119739999 43.1103360170001, -87.88690795399999 43.1079359170001, -87.8866629299999 43.107595959, -87.88529808200001 43.1065839390001, -87.884365954 43.105751927, -87.8840049359999 43.105674041, -87.883693057 43.105362997, -87.883441013 43.1052389810001, -87.88327504499991 43.1050120080001, -87.88318194999989 43.1044599520001, -87.8829569819999 43.104275933, -87.882854025 43.1040100160001, -87.882130987 43.103447932, -87.88168506299991 43.103253049, -87.879797074 43.101954054, -87.87792797100001 43.1010090560001, -87.877320927 43.1001770440001, -87.876423062 43.099164022, -87.876224001 43.0986719680001, -87.876194083 43.097975003, -87.8759910109999 43.097549971, -87.87578292400001 43.096683027, -87.87550296800001 43.095935921, -87.874962946 43.0953420800001, -87.875058047 43.0949240680001, -87.8747110689999 43.093784021, -87.8745230389999 43.0935470200001, -87.8740640779999 43.0924380600001, -87.8730990239999 43.0907170420001, -87.872842969 43.0903229310001, -87.8724289689999 43.089913944, -87.872048062 43.088640019, -87.871706933 43.0882109770001, -87.8714109319999 43.088007068, -87.87136597200001 43.0877010390001, -87.87121003199999 43.0875539580001, -87.871119945 43.0871459740001, -87.870612013 43.08643497, -87.87068404999999 43.0860099380001, -87.870505045 43.0856380560001, -87.8705560219999 43.0850870030001, -87.870460921 43.084771948, -87.8705229289999 43.0834609190001, -87.870372003 43.0833059820001, -87.8703770169999 43.082814931, -87.87056203899991 43.0826680170001, -87.87070193300001 43.082210059, -87.87069792200001 43.0819519980001, -87.87016207800001 43.0804139960001, -87.869682058 43.079476018, -87.869131005 43.078615927, -87.8685040709999 43.0778950610001, -87.86756391999999 43.075960942, -87.86689704 43.0748250730001, -87.866615079 43.0744739160001, -87.86651596599999 43.074391016, -87.866268936 43.074366948, -87.86395508 43.0743609310001, -87.86375802399991 43.074113066, -87.863796967 43.070705961, -87.864487079 43.0699580190001, -87.865627962 43.069208071, -87.866357018 43.068530996, -87.86681798399999 43.067750963, -87.8675520529999 43.066963076, -87.86778203499991 43.0666189390001, -87.868060988 43.065972951, -87.868462955 43.065383957, -87.86856306999989 43.0648260510001, -87.8686820719999 43.0645850380001, -87.86888096599991 43.064503976, -87.86980005700001 43.0645250360001, -87.871122954 43.063551959, -87.871643922 43.06298603, -87.871920034 43.062897949, -87.873741001 43.06117693, -87.874506994 43.060362969, -87.87529204000001 43.0593860480001, -87.875256941 43.0589289260001, -87.8753949969999 43.0582100660001, -87.875526033 43.057983929, -87.8759189739999 43.0576830810001, -87.8763409969999 43.057499062, -87.877822006 43.056370046, -87.87784306499999 43.055923955, -87.877913932 43.0557999380001, -87.87830002 43.055435077, -87.878632959 43.0554599800001, -87.879313043 43.054957062, -87.88002805799989 43.054345003, -87.88018800899989 43.0539410310001, -87.88087895699989 43.0533889750001, -87.88097807 43.0534279180001, -87.880981078 43.053640016, -87.8810950659999 43.053648039, -87.88146293699999 43.053558954, -87.881782003 43.0533379980001, -87.88182997199991 43.0528619890001, -87.881490013 43.0528250520001, -87.88146093099991 43.052764047, -87.882255003 43.0521080300001, -87.88182495699991 43.0512970780001, -87.8819969419999 43.051197965, -87.881866073 43.0463250610001, -87.881756932 43.0462809360001, -87.881756932 43.046150067, -87.88396799900001 43.046216923, -87.886011928 43.044224974, -87.887017931 43.043648014, -87.8891720029999 43.042847925, -87.89036503299999 43.042579, -87.891696955 43.0424939270001, -87.89483998199999 43.0424830630001, -87.895041049 43.0423799390001, -87.895913007 43.0406530710001, -87.896259985 43.039711082, -87.89648996699999 43.0387630760001, -87.896546961 43.037934072, -87.89641893300001 43.0378489990001, -87.89490198999989 43.0379210350001, -87.894889956 43.0378080500001, -87.894115941 43.037701917, -87.89374807 43.037498009, -87.89363408199991 43.0371119210001, -87.89412095500001 43.034961024, -87.89424497100001 43.0348899900001, -87.89430296800001 43.034972055, -87.893878939 43.037172926, -87.89389699 43.0373139910001, -87.894046077 43.0374759470001, -87.8944340039999 43.037548986, -87.8948279479999 43.037401069, -87.8948789249999 43.037199, -87.89478198499999 43.0368379820001, -87.89483998199999 43.036688059, -87.89496700700001 43.0366130140001, -87.89528206200001 43.036681039, -87.896997063 43.0365969690001, -87.89705405700001 43.036296957, -87.89689393899999 43.0362030250001, -87.896817056 43.0358450160001, -87.8969410719999 43.035110946, -87.89685399299999 43.034843025, -87.896553981 43.034401948, -87.89672396 43.034309019, -87.897231056 43.0344260160001, -87.897426942 43.0342239460001, -87.898147974 43.030766031, -87.89817304499999 43.030255926, -87.897981004 43.029697017, -87.897314959 43.0290809470001, -87.896107054 43.0291180520001, -87.896045046 43.0293390080001, -87.895621017 43.029745989, -87.8954450209999 43.030331974, -87.89563606 43.030949047, -87.896024989 43.031431072, -87.897090995 43.0319799530001, -87.8971469859999 43.032152941, -87.89704102 43.0322950080001, -87.8964909699999 43.0326010370001, -87.896167057 43.0330439530001, -87.89613697199999 43.033502078, -87.896453029 43.0340340770001, -87.896422945 43.034152077, -87.896235082 43.0342090710001, -87.8957540589999 43.0341310170001, -87.895326019 43.034265062, -87.8950460629999 43.034613043, -87.8949459469999 43.035176966, -87.8948050499999 43.035218082, -87.89490499899991 43.0345420090001, -87.894833965 43.03438607, -87.89477998 43.033759971, -87.894613009 43.0330329220001, -87.89405192700001 43.031867971, -87.89397604600001 43.031442939, -87.894006967 43.0309480440001, -87.894322022 43.029956917, -87.894883939 43.029418064, -87.895092026 43.029291039, -87.89536395899999 43.0292529320001, -87.89563505699989 43.0290570460001, -87.8957649229999 43.028828067, -87.895891948 43.0287819370001, -87.895839968 43.0259900670001, -87.8952850699999 43.026008953, -87.8952740389999 43.025906999, -87.89625096 43.025861036, -87.894898982 43.025181955, -87.894662983 43.024949968, -87.894185972 43.022909048, -87.89711807099999 43.020316071, -87.897301923 43.020039959, -87.897150997 43.019631976, -87.8970219669999 43.019516985, -87.896870038 43.019523002, -87.8947629309999 43.021352994, -87.894681034 43.0213630220001, -87.894297954 43.020619928, -87.894290934 43.0204360760001, -87.8965999439999 43.0183769380001, -87.89650099799999 43.018065058, -87.8962539679999 43.017696018, -87.896048054 43.0177389720001, -87.893870917 43.0195360390001, -87.89370294299989 43.019424056, -87.893057958 43.018156984, -87.89307901799999 43.01795107, -87.895176932 43.016187933, -87.89539605 43.015934051, -87.8954030689999 43.015827082, -87.8916190679999 43.00728801, -87.891545026 43.007240041, -87.891116986 43.0073199330001, -87.88761695299991 43.008166988, -87.8843880159999 43.004903955, -87.884398045 43.0048040070001, -87.88470507700001 43.004569011, -87.88783606999991 43.002345075, -87.88782503899991 43.0022740410001, -87.886666941 43.001384032, -87.8877690479999 43.0006060050001, -87.887779076 43.0005199290001, -87.88758101799991 43.000516921, -87.887188077 43.000810081, -87.886996035 43.0007609420001, -87.8858559879999 42.999583957, -87.885750023 42.999091068, -87.88473198600001 42.9981990530001, -87.88406794699991 42.9977730190001, -87.8833099769999 42.9975980250001, -87.88265997799989 42.9977049940001, -87.88236197099999 42.997388936, -87.88261802700001 42.996957052, -87.88262905800001 42.9967919200001, -87.882487993 42.996523998, -87.882330048 42.9964429360001, -87.882214054 42.9961870480001, -87.881652973 42.9958149990001, -87.880318043 42.994088966, -87.87884706200001 42.993048032, -87.87814792499999 42.992442993, -87.8769299909999 42.991672989, -87.8747849439999 42.990651943, -87.8747429919999 42.990315996, -87.8742449219999 42.9899250610001, -87.8718750739999 42.988442047, -87.86874591899991 42.986623921, -87.867498068 42.986072032, -87.865415029 42.9846000490001, -87.86436406599989 42.983988993, -87.8631949369999 42.982946053, -87.862415071 42.982415056, -87.861410072 42.9819129740001, -87.8605210649999 42.981058063, -87.85972097599991 42.98013797, -87.8594819689999 42.9799790220001, -87.85906796899999 42.979929047, -87.85874606100001 42.979762077, -87.856599008 42.977863056, -87.856221945 42.977745057, -87.8547929169999 42.9776639950001, -87.85444694099991 42.976979064, -87.854665056 42.9767880260001, -87.855227977 42.976540996, -87.8552659169999 42.976415977, -87.8551340449999 42.9762640480001, -87.85521092899999 42.976125993, -87.854872976 42.975888991, -87.85440499000001 42.975799071, -87.85440499000001 42.975469977, -87.85428097399991 42.975027061, -87.853279985 42.973625945, -87.851928007 42.9725930330001, -87.851150983 42.971739961, -87.8504219279999 42.9710879560001, -87.850012941 42.970479073, -87.84958206 42.9695740220001, -87.8484530439999 42.9678849260001, -87.847941936 42.9669489550001, -87.847416956 42.9657280120001, -87.84737701 42.965010991, -87.846316019 42.963997969, -87.846027038 42.963149075, -87.845250014 42.9621689790001, -87.845250014 42.9619859630001, -87.84490704699989 42.961107988, -87.844692944 42.9599699460001, -87.844627927 42.958260962, -87.844669043 42.957808018, -87.84486008099999 42.957583051, -87.844957021 42.9566800050001, -87.8453060049999 42.95642395, -87.845475984 42.955956966, -87.84535096499999 42.9549499610001, -87.84499796999999 42.954036051, -87.843641981 42.951463967, -87.843313053 42.95116596, -87.843260071 42.950693963, -87.8435159589999 42.950434063, -87.843540027 42.95020592, -87.843233997 42.9490730600001, -87.843349991 42.9488840270001, -87.843449939 42.9484339250001, -87.843476013 42.9479649360001, -87.84340197099991 42.947488927, -87.84349506699991 42.9470329750001, -87.843258065 42.9459380550001, -87.842909917 42.9448939450001, -87.842894039 42.944349075, -87.8429849619999 42.9436260370001, -87.84289704699999 42.9429630010001, -87.843237006 42.9419060210001, -87.84390605899991 42.94056006, -87.8446309349999 42.937946024, -87.84466102 42.9369340050001, -87.84483801899999 42.9364909220001, -87.8451390339999 42.935216997, -87.845119981 42.9347590400001, -87.845366008 42.9341190690001, -87.845439047 42.9335439480001, -87.84581293399999 42.932209018, -87.845886976 42.9300669790001, -87.845792042 42.929607015, -87.845846028 42.929109947, -87.845471973 42.9271200040001, -87.84500097900001 42.926017061, -87.844895013 42.92506705, -87.844076038 42.9234489880001, -87.84398795600001 42.9229109720001, -87.84390104399991 42.9227550320001, -87.84408506299999 42.9226649450001, -87.844064004 42.922308941, -87.843664043 42.921074962, -87.84260605999999 42.9191329880001, -87.83997297099999 42.915393947, -87.83947306100001 42.9148659580001, -87.839442976 42.9140269260001, -87.839323974 42.913215973, -87.839444982 42.9130249350001, -87.839894917 42.912769047, -87.840231031 42.912446972, -87.840742975 42.911053042, -87.840780079 42.906515083, -87.840550933 42.906351956, -87.841131069 42.9063999250001, -87.8413959819999 42.9065309610001, -87.843007024 42.9069860770001, -87.843282969 42.9069379410001, -87.84329500299999 42.906751081, -87.8429269649999 42.906594974, -87.842924959 42.9064129610001, -87.84361991900001 42.9056349350001, -87.8436020349999 42.905570921, -87.842873982 42.9052769250001, -87.842888022 42.9052279540001, -87.84350108300001 42.9051960310001, -87.844662023 42.904613054, -87.845024044 42.9043080270001, -87.845627077 42.903570949, -87.8463220359999 42.9023000330001, -87.846573077 42.9013399930001, -87.84656104299999 42.9009550750001, -87.84704106299991 42.8999880150001, -87.847190986 42.898903959, -87.84718296299999 42.898459038, -87.84712797500001 42.89826098, -87.846943956 42.8981650430001, -87.84695899899999 42.897794999, -87.847060953 42.8977919910001, -87.8471149379999 42.898048046, -87.84729294 42.8979719980001, -87.8471799549999 42.8979280410001, -87.84718597200001 42.897789985, -87.84720803399991 42.89778096, -87.847438016 42.897789985, -87.847778977 42.897633043, -87.847959987 42.8972019940001, -87.84799792699989 42.8966210230001, -87.848130969 42.8961909770001, -87.847853019 42.894812926, -87.847693068 42.894457925, -87.847759923 42.893991945, -87.8473980699999 42.8928360190001, -87.8469740409999 42.8920850690001, -87.846929917 42.891789068, -87.84656806300001 42.8910939410001, -87.8459389559999 42.890457982, -87.84366304 42.890374079, -87.84342603899999 42.890126046, -87.843466987 42.8870819640001, -87.843605043 42.885271026, -87.843748949 42.885137984, -87.846214065 42.8841719270001, -87.846357971 42.8839770450001, -87.845490024 42.8819670450001, -87.845156918 42.881452929, -87.84499596400001 42.881031073, -87.844820971 42.8808209800001, -87.84449204399991 42.8808310090001, -87.8444549389999 42.8807419240001, -87.8443810639999 42.880147916, -87.84456508300001 42.8797150290001, -87.844380061 42.879383929, -87.84435398799999 42.878881011, -87.8444250219999 42.8783630510001, -87.8443600049999 42.878157973, -87.84419403699999 42.878099976, -87.8439379819999 42.877228018, -87.84401904399989 42.8771409390001, -87.844009015 42.876987005, -87.843598023 42.8763869800001, -87.843438073 42.8759910310001, -87.8434069849999 42.87555196, -87.843050981 42.8747359930001, -87.84306101 42.874590917, -87.8431820169999 42.8744460080001, -87.843596018 42.87424795, -87.84375897699989 42.8740849910001, -87.843695966 42.8735720450001, -87.843120009 42.8724520540001, -87.84269999199989 42.871822947, -87.842590015 42.8714550770001, -87.841668918 42.869815956, -87.841339991 42.8696070330001, -87.840850946 42.869126011, -87.840446974 42.868488045, -87.84029504499991 42.867943009, -87.84014595799989 42.867691968, -87.84015297799991 42.867554079, -87.840329977 42.8672490530001, -87.84015297799991 42.8669630800001, -87.839975979 42.866357038, -87.83928804 42.8653839610001, -87.838728964 42.864324976, -87.838122922 42.8628700410001, -87.8378529939999 42.8625060150001, -87.8375240669999 42.86165896, -87.8373290169999 42.8608130750001, -87.83677996900001 42.8593730150001, -87.836301955 42.8585620630001, -87.835780986 42.8573509820001, -87.83441697400001 42.855128048, -87.8328510599999 42.8528700160001, -87.831635967 42.8514680640001, -87.83083504299999 42.8507759460001, -87.82976903799999 42.849697071, -87.829144945 42.849222065, -87.82856397400001 42.848896982, -87.82809698999991 42.848751071, -87.82675804900001 42.8491339830001, -87.826464054 42.8490310270001, -87.82499006499999 42.8462169270001, -87.8250609309999 42.84613904, -87.82788806799989 42.845278949, -87.827859989 42.8450630070001, -87.82756198200001 42.844400974, -87.826981011 42.843462996, -87.82636046899999 42.842236106, -87.84388491199999 42.842125004, -87.852785915 42.842305004, -87.8919649269999 42.8427690020001, -87.910284932 42.8428250010001, -87.913786933 42.842724, -87.926586937 42.8430250000001, -87.933071939 42.8430269990001, -87.9509069439999 42.843541998, -87.981857953 42.843616997, -88.010893962 42.843600995, -88.06992997899989 42.8433309910001, -88.12363399500001 42.8432289880001, -88.125156996 42.8432799880001, -88.13224999800001 42.843199988, -88.132624998 42.843131988, -88.161118006 42.842870986, -88.168024008 42.8429279860001, -88.188106014 42.842847985, -88.197887017 42.842720984, -88.2293150259999 42.841922982, -88.229968027 42.842166982, -88.23062802699999 42.8420889820001, -88.2327980269999 42.8421349820001, -88.23356302799991 42.842079982, -88.2548790339999 42.8419859810001, -88.306390049 42.8421029780001, -88.3069820489999 42.8421909780001, -88.316218052 42.842436977, -88.3339390569999 42.842549976, -88.345864061 42.8428869750001, -88.382625072 42.842810973, -88.40984308 42.842707972, -88.4121240799999 42.842644971, -88.417107082 42.8426929710001, -88.42407608400001 42.842594971, -88.4493900909999 42.8426599690001, -88.46335209499991 42.8425949680001, -88.541541119 42.843003964, -88.5416881199999 42.8519029650001, -88.542058121 42.8661639680001, -88.541882121 42.868274968, -88.54218612299999 42.87912297, -88.542088123 42.8808039700001, -88.542109123 42.883747971, -88.54204512299999 42.8841019710001, -88.54215312299991 42.884766971, -88.54228312399999 42.887425971, -88.5421701239999 42.8937289720001, -88.5420071299999 42.946279981, -88.541861131 42.960097983, -88.541557133 42.9748629860001, -88.54173713499991 42.9980639890001, -88.541497136 43.0030559900001, -88.541718136 43.005000991, -88.541718137 43.010712992, -88.541573137 43.015505992, -88.541585138 43.019394993, -88.540905139 43.036046996, -88.54092514 43.038159996, -88.540592141 43.048311998, -88.54007814399991 43.0773430030001, -88.53992314600001 43.0954780060001, -88.53917914899991 43.1278290110001, -88.539324149 43.1290890110001, -88.53906114900001 43.1294490110001, -88.5390031489999 43.129648011, -88.53873315 43.140266013, -88.538441151 43.146204014, -88.538025152 43.160268016, -88.5378151529999 43.1636740170001, -88.537829153 43.1651300170001, -88.537720153 43.165467017, -88.53709815400001 43.176504019, -88.5369051539999 43.1781920190001, -88.535849156 43.1960560220001, -88.5167761499999 43.195745023, -88.50660814699989 43.195670024, -88.48654014100001 43.1958550250001, -88.4576151319999 43.1956940270001, -88.431287125 43.195158028, -88.4179931209999 43.194705029, -88.41824412299999 43.2117270320001, -88.418322124 43.223100034, -88.418628126 43.2384150360001, -88.418521126 43.245261037, -88.418778128 43.2575770390001, -88.41927312999999 43.2746980420001, -88.419157132 43.2913650450001, -88.418995133 43.302454047, -88.418965134 43.311812048, -88.41871213500001 43.32544705, -88.41877913899999 43.354359055, -88.41844514 43.3701830580001, -88.40155013499999 43.370037059, -88.4015831359999 43.37534606, -88.401347137 43.385854061, -88.401202138 43.3968440630001, -88.4010851419999 43.4289220680001, -88.400900142 43.4354060690001, -88.400936143 43.43732707, -88.400812143 43.4428530710001, -88.400628145 43.4642990740001, -88.40049914799989 43.4859150780001, -88.4004931489999 43.492362079, -88.40057514900001 43.4930000790001, -88.4004721489999 43.4954110790001, -88.400584149 43.4964190790001, -88.4004891499999 43.505861081, -88.40071215099989 43.5088660810001, -88.400746153 43.529620085, -88.4007141539999 43.535446086, -88.40041915400001 43.540176086, -88.400432154 43.5435400870001, -88.38097614899991 43.543384088, -88.340947137 43.54328209))"),
        ST_GEOGPOINT(longitude, latitude)
        )
),

geoscaling_factor_table as (
    select stddev_distance_avg_latitude as geoscaling_factor
    from standard_deviation_of_milwaukee
),

scaling_geocomponents as (
    select adding_first_transformation_to_delta_meters.* except(latitude, longitude, distance_avg_latitude, distance_avg_longitude),
        distance_avg_latitude / geoscaling_factor as latitude_trf,
        distance_avg_longitude / geoscaling_factor as longitude_trf,
    from adding_first_transformation_to_delta_meters, geoscaling_factor_table
)

select *
from scaling_geocomponents